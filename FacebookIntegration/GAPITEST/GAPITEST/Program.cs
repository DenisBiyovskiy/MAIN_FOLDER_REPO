using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using FacebookGraphAPIHelper;
using FacebookGraphAPIHelper.Objects;
using System.Drawing;
using Newtonsoft.Json;
using System.IO;
using System.Security.Cryptography;

namespace GAPITEST
{
    class Program
    {
        static void Main(string[] args)
        {
            
            //uphUserId	uphPageToken	uphAppSecret	uphAppId	uphPageId
            //1091321741005034	EAAFFru3lRl0BAO8M52suZA1bDDuU4Sofsl85QZAVB3erojkZCTYBhnH6WXIQYl8gdxrbT57xZBrq1ZBOyiyUprYu1ERq1BMwmVKicDoUehDNkp66n6NSihqsZBjMV7eLV7yNZAZCwniekMYut2c8u12B9Dyb7z8X4HKIxp9gmPLZAmQZDZD	81f78efeb40c979e3c029d9f8c533212	358092594562653	1369352673095644
            Tools.ClearFile();
            //connection params
            string appID = "391897567851647";
            string appSecret = "52d25a29757683b9e490cb0608cdc0c2";
            string exToken = "EAAFkbcNR9H8BAOhLQCMVU7D2TJ8kVRGFNxHBAPBiMa0aaXktK3avWCeYo8DJFu7tCf4H5XCLrqG5THXAZCtiZCqg1QmdkkV6N5XbpYYJy7bZCbvnLw0gZCC569dKHZBM08Pw7xZCvo0YN8BUqUCZB4dbKuDQdwgOtPs8WZCWENEDYOdQU0QyPxmWgAG7UEEy7BAZD";
            string pageId = "1863819113839065";
            string accToken = "";
            string pageToken = "";
            GraphAPIHelper gepiHelper = new GraphAPIHelper(appID, appSecret, exToken);

            //BaseResponse res = gepiHelper.GetLongLivedAccessToken(exToken, out accToken);
            //Accounts accs;
            //res = gepiHelper.GetUserAccounts(accToken, out accs);
            //Tools.WriteToFile(accs);
            Posts<Post> posts;
            //gepiHelper.GetTopPosts(pageId, accToken, out posts);
            //Tools.WriteToFile(posts);
            //res = gepiHelper.GetPageAccessToken(out pageToken);
            //Tools.WriteToFile(pageToken);
            //----- gepiHelper.PostMessage(pageId, accs.data[0].access_token, "autogenerated message 4");
            //Tools.ClearFile();
            //var url = "https://www.facebook.com/IntegrationTest-1369352673095644/";
            //var a = gepiHelper.GetPageByUrl(url);
            //var pic = gepiHelper.LoadPictureFromUrl(a.picture.data.url);
            //Tools.WriteToFile(a);
            //Tools.WriteToFile(pic);
            //var br = gepiHelper.GetPageByUrl("https://www.facebook.com/TestIra-1491247927554351/");
            //Tools.WriteStringToFile(br);
            
            var br = gepiHelper.GetAllPosts("1369352673095644", out posts);
            /*Tools.WriteStringToFile(posts.data.Count);
            string postsRCount = "";
            var flag = true;
            for (int i = 0; i < posts.data.Count; i++)
            {
                var count = 0;
                if (posts.data[i].reactions != null)
                {
                    postsRCount += i + " " + posts.data[i].reactions.data.Count + "\n";
                    count = posts.data[i].reactions.data.Count;
                }
                if (count > 1000 && flag)
                {
                    Tools.WriteToFile(posts.data[i].reactions);
                    flag = false;
                }
            }*/
            Tools.WriteToFile(posts);
             
            
        //    //Парсим данные из бд.
        //    Tools.ClearFile();
        //    var s = "7B0D0A2020224C65616443617365223A207B0D0A2020202022494931223A202233313839623837612D363732382D346639392D386566372D373462333837356664353661222C0D0A2020202022554964223A202238656137303263382D373435612D346165352D393365352D653637353733393535306335222C0D0A2020202022484B31223A20224C65616443617365222C0D0A2020202022484B34223A20747275652C0D0A2020202022484B39223A20747275652C0D0A2020202022484B37223A20226E756C6C222C0D0A2020202022484B32223A20312C0D0A2020202022484B3131223A20225C2F446174652831343837363639373339363339295C2F222C0D0A2020202022484D38223A202238656137303263382D373435612D346165352D393365352D653637353733393535306335222C0D0A2020202022484D31223A202232643432373131302D333034372D343064352D613764352D356135356137353132656665222C0D0A2020202022484D32223A202244636D536368656D614D616E61676572222C0D0A2020202022484D35223A205B5D2C0D0A2020202022484D37223A205B0D0A2020202020207B0D0A20202020202020202231636265613233652D643964332D343231622D616234392D643939326438353136393737223A205B0D0A202020202020202020207B0D0A2020202020202020202020202244636D536368656D6153746172745369676E616C223A207B0D0A202020202020202020202020202022554964223A202265633937373236382D343332642D343035632D383232342D633861393538313030376630222C0D0A202020202020202020202020202022484B31223A202244636D536368656D6153746172745369676E616C222C0D0A202020202020202020202020202022484B35223A202238656137303263382D373435612D346165352D393365352D653637353733393535306335222C0D0A202020202020202020202020202022484B34223A20747275652C0D0A202020202020202020202020202022484B39223A20747275652C0D0A202020202020202020202020202022484B36223A202231636265613233652D643964332D343231622D616234392D643939326438353136393737222C0D0A202020202020202020202020202022484B37223A20225465727261736F66742E436F72652E50726F636573732E50726F63657373536368656D6153746172745369676E616C4576656E74222C0D0A202020202020202020202020202022484B32223A20322C0D0A202020202020202020202020202022484C32223A202238656137303263382D373435612D346165352D393365352D653637353733393535306335222C0D0A202020202020202020202020202022485231223A20226E756C6C222C0D0A202020202020202020202020202022456E74697479536368656D61554964223A202234316166383965392D373530622D346562622D386361632D666633396236343834316563222C0D0A2020202020202020202020202020225265636F72644964223A202233313065336561632D386231342D346637362D613563392D313766636439386661386336220D0A2020202020202020202020207D0D0A202020202020202020207D0D0A20202020202020205D0D0A2020202020207D2C0D0A2020202020207B0D0A20202020202020202265323962363438632D316462302D346433382D393536362D383333663965363864663938223A205B0D0A202020202020202020207B0D0A2020202020202020202020202244636D536368656D61496E7465726D65646961746543617463685369676E616C223A207B0D0A202020202020202020202020202022554964223A202237346331396534302D383336652D346339662D383666622D313562326235666333386164222C0D0A202020202020202020202020202022484B31223A202244636D536368656D61496E7465726D65646961746543617463685369676E616C222C0D0A202020202020202020202020202022484B35223A202238656137303263382D373435612D346165352D393365352D653637353733393535306335222C0D0A202020202020202020202020202022484B34223A20747275652C0D0A202020202020202020202020202022484B36223A202265323962363438632D316462302D346433382D393536362D383333663965363864663938222C0D0A202020202020202020202020202022484B37223A20225465727261736F66742E436F72652E50726F636573732E50726F63657373536368656D61496E7465726D65646961746543617463685369676E616C4576656E74222C0D0A202020202020202020202020202022484B32223A20312C0D0A202020202020202020202020202022484C32223A202238656137303263382D373435612D346165352D393365352D653637353733393535306335222C0D0A202020202020202020202020202022484C33223A20747275652C0D0A202020202020202020202020202022484A33223A20747275652C0D0A202020202020202020202020202022484A34223A20322C0D0A202020202020202020202020202022484A36223A20747275652C0D0A202020202020202020202020202022484A39223A20225B5C2262633063326436302D356133642D343834302D616134652D6336306561373736653230365C225D222C0D0A202020202020202020202020202022484A3130223A202234316166383965392D373530622D346562622D386361632D666633396236343834316563222C0D0A202020202020202020202020202022484A3131223A202233313065336561632D386231342D346637362D613563392D313766636439386661386336222C0D0A202020202020202020202020202022484A3133223A20226E756C6C220D0A2020202020202020202020207D0D0A202020202020202020207D0D0A20202020202020205D0D0A2020202020207D2C0D0A2020202020207B0D0A20202020202020202239343832373163372D626630642D346530312D613332352D303739373539623033633864223A205B0D0A202020202020202020207B0D0A20202020202020202020202022537461676531223A207B0D0A202020202020202020202020202022554964223A202236303436633239632D363463642D346237642D613966392D653837333030646235386134222C0D0A202020202020202020202020202022484B31223A2022537461676531222C0D0A202020202020202020202020202022484B32223A20310D0A2020202020202020202020207D0D0A202020202020202020207D0D0A20202020202020205D0D0A2020202020207D0D0A202020205D2C0D0A2020202022483130223A20747275652C0D0A2020202022483131223A20747275650D0A20207D0D0A7D";
        //    var b = StringToByteArray(s);
        //    Tools.WriteToFile(b);

        }
        //public static byte[] StringToByteArray(string hex)
        //{
        //    return Enumerable.Range(0, hex.Length)
        //                     .Where(x => x % 2 == 0)
        //                     .Select(x => Convert.ToByte(hex.Substring(x, 2), 16))
        //                     .ToArray();
        //}
    }
}
