using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using FacebookGraphAPIHelper;
using FacebookGraphAPIHelper.Objects;
using System.Drawing;
using Newtonsoft.Json;
using System.IO;
using System.Security.Cryptography;

namespace GAPITEST
{
    class Program
    {
        static void Main(string[] args)
        {
            
            //uphUserId	uphPageToken	uphAppSecret	uphAppId	uphPageId
            //1091321741005034	EAAFFru3lRl0BAO8M52suZA1bDDuU4Sofsl85QZAVB3erojkZCTYBhnH6WXIQYl8gdxrbT57xZBrq1ZBOyiyUprYu1ERq1BMwmVKicDoUehDNkp66n6NSihqsZBjMV7eLV7yNZAZCwniekMYut2c8u12B9Dyb7z8X4HKIxp9gmPLZAmQZDZD	81f78efeb40c979e3c029d9f8c533212	358092594562653	1369352673095644
            Tools.ClearFile();
            //connection params
            string appID = "391897567851647";
            string appSecret = "52d25a29757683b9e490cb0608cdc0c2";
            string exToken = "EAAFkbcNR9H8BAPeoaruVPaaNl5PYQsbH0QIrrNXGc0GLZCUowNp99URAnpnzfwZCi4cVkJDBZCQFsKmtzDaAj5p0ExqNJBYUVs7MOkVwG6sh4fdsz5dBDZChYtQkDaemytHtZCK1jHhZBQuIHwKMBNRpHi1iTLndYZD";
            string pageId = "1863819113839065";
            string accToken = "";
            string pageToken = "";
            GraphAPIHelper gepiHelper = new GraphAPIHelper(appID, appSecret, exToken);

            BaseResponse res = gepiHelper.GetLongLivedAccessToken(exToken, out accToken);
            //Accounts accs;
            //res = gepiHelper.GetUserAccounts(accToken, out accs);
            //Tools.WriteToFile(accs);
            Posts posts;
            //gepiHelper.GetTopPosts(pageId, accToken, out posts);
            //Tools.WriteToFile(posts);
            //res = gepiHelper.GetPageAccessToken(out pageToken);
            //Tools.WriteToFile(pageToken);
            //----- gepiHelper.PostMessage(pageId, accs.data[0].access_token, "autogenerated message 4");
            //Tools.ClearFile();
            //var url = "https://www.facebook.com/IntegrationTest-1369352673095644/";
            //var a = gepiHelper.GetPageByUrl(url);
            //var pic = gepiHelper.LoadPictureFromUrl(a.picture.data.url);
            //Tools.WriteToFile(a);
            //Tools.WriteToFile(pic);
            var br = gepiHelper.GetPageByUrl("https://www.facebook.com/TestIra-1491247927554351/");
            Tools.WriteStringToFile(br);
            /*
            var br = gepiHelper.GetAllPosts("1491247927554351", out posts);
            Tools.WriteStringToFile(posts.data.Count);
            string postsRCount = "";
            var flag = true;
            for (int i = 0; i < posts.data.Count; i++)
            {
                var count = 0;
                if (posts.data[i].reactions != null)
                {
                    postsRCount += i + " " + posts.data[i].reactions.data.Count + "\n";
                    count = posts.data[i].reactions.data.Count;
                }
                if (count > 1000 && flag)
                {
                    Tools.WriteToFile(posts.data[i].reactions);
                    flag = false;
                }
            }
            Tools.WriteToFile(postsRCount);*/
             
            
            //Парсим данные из бд.
            /*Tools.ClearFile();
            var s = "EFBBBF7B0D0A2020225061636B61676544617461223A205B0D0A202020207B0D0A20202020202022526F77223A205B0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202261653065343563612D633439352D346665372D613339642D336162373237386531363137222C0D0A202020202020202020202256616C7565223A202264626166646264612D646338632D343664312D393161652D343337613532656366383565220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202237333663333061372D633065632D346661392D623033342D323535326233313962363333222C0D0A202020202020202020202256616C7565223A2022D090D0B4D0BCD0B8D0BDD0B8D181D182D180D0B0D182D0BED180D18B2046616365626F6F6B220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202239653533666437632D646465342D343530322D613634632D623965333431343831303862222C0D0A202020202020202020202256616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202239666536316664652D353336622D346365662D396265372D643434613233636136646664222C0D0A202020202020202020202256616C7565223A20310D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202266613434383362332D613264622D343635312D613436322D363839626531383335316537222C0D0A202020202020202020202256616C7565223A202261323961336261352D346230642D646531312D396135312D303035303536633030303038222C0D0A2020202020202020202022446973706C617956616C7565223A2022D092D181D0B520D181D0BED182D180D183D0B4D0BDD0B8D0BAD0B820D0BAD0BED0BCD0BFD0B0D0BDD0B8D0B8220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202231346637386463382D653665662D343861342D623565312D306665333336306565376233222C0D0A202020202020202020202256616C7565223A20226E756C6C222C0D0A2020202020202020202022446973706C617956616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202263376434636339342D636365612D346336642D613630302D306265333266623234366539222C0D0A202020202020202020202256616C7565223A20226E756C6C222C0D0A2020202020202020202022446973706C617956616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202265353165396436632D613061632D343832312D386139642D326562363061376662306166222C0D0A202020202020202020202256616C7565223A2066616C73650D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202266353566363863332D366661372D346631382D396661372D636264323930333133643666222C0D0A202020202020202020202256616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202261633965346239632D656533632D343964652D623835302D363430653665353032376136222C0D0A202020202020202020202256616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202234386633373434322D613264612D343430372D393137382D373230373362613662303966222C0D0A202020202020202020202256616C7565223A20747275650D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202234353137303633322D613634652D343633392D626464342D613236306533333965336136222C0D0A202020202020202020202256616C7565223A2066616C73650D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202236626335303834612D353664362D343061312D613739362D646239373933323265653831222C0D0A202020202020202020202256616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202261303539653763632D326130362D346230332D393661632D343733623730353531356164222C0D0A202020202020202020202256616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202261666565323137392D343535642D343833362D623239662D623266313336393138363639222C0D0A202020202020202020202256616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202262306363363133312D653033342D343536322D393532362D336633613831663061313631222C0D0A202020202020202020202256616C7565223A2066616C73650D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202239333962663634642D383961352D343631332D393234302D643061626331323764666635222C0D0A202020202020202020202256616C7565223A202231613737386533662D306138652D653131312D383461332D303031353564303534633033222C0D0A2020202020202020202022446973706C617956616C7565223A202272752D5255220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202231613863666635382D616464302D343339302D623030632D663666306461393731633532222C0D0A202020202020202020202256616C7565223A20300D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202264303565633736342D326537302D343233382D623937322D623531393463643439336537222C0D0A202020202020202020202256616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202232626366396235382D396364332D343865642D383932652D633537646438633665656465222C0D0A202020202020202020202256616C7565223A20226E756C6C220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202234643033656230342D313935622D343365352D393233382D633938363462303862343462222C0D0A202020202020202020202256616C7565223A20226E756C6C220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202262303664303433312D613032302D343639662D623932392D373763623365366436313730222C0D0A202020202020202020202256616C7565223A20226E756C6C222C0D0A2020202020202020202022446973706C617956616C7565223A2022220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202236316538353462652D303339342D346337632D623730332D636431646564306161623435222C0D0A202020202020202020202256616C7565223A20300D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202262396532643865352D353562372D346238312D616462332D313937393664373531313430222C0D0A202020202020202020202256616C7565223A20226E756C6C220D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202237653133323431312D316265622D343533622D396564342D333031343166636330383934222C0D0A202020202020202020202256616C7565223A2066616C73650D0A20202020202020207D2C0D0A20202020202020207B0D0A2020202020202020202022536368656D61436F6C756D6E554964223A202264393535323765372D623732382D343134322D383535392D653961663965653864323264222C0D0A202020202020202020202256616C7565223A20226E756C6C222C0D0A2020202020202020202022446973706C617956616C7565223A2022220D0A20202020202020207D0D0A2020202020205D0D0A202020207D0D0A20205D0D0A7D";
            var b = StringToByteArray(s);
            Tools.WriteToFile(b);*/

         }
        public static byte[] StringToByteArray(string hex)
        {
            return Enumerable.Range(0, hex.Length)
                             .Where(x => x % 2 == 0)
                             .Select(x => Convert.ToByte(hex.Substring(x, 2), 16))
                             .ToArray();
        }
    }
}
